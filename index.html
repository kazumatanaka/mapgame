<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éƒ½é“åºœçœŒï¼†çœŒåºæ‰€åœ¨åœ°ãƒã‚¹ã‚¿ãƒ¼</title>
    <style>
        body { font-family: "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif; text-align: center; background-color: #f0f8ff; padding: 20px; }
        h1 { color: #333; font-size: 24px; margin-bottom: 10px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        /* Menu Buttons */
        .menu-btn { display: block; width: 100%; margin: 10px 0; padding: 15px; font-size: 18px; color: white; background-color: #4CAF50; border: none; border-radius: 8px; cursor: pointer; transition: background 0.3s; }
        .menu-btn:hover { background-color: #45a049; }
        .menu-btn:nth-child(3), .menu-btn:nth-child(4) { background-color: #2196F3; } /* Different color for harder modes */

        /* Game Area */
        #game-area { display: none; }
        .question-box { font-size: 32px; font-weight: bold; margin: 20px 0; min-height: 50px; color: #333; }
        .sub-text { font-size: 16px; color: #666; margin-bottom: 20px; }
        
        /* Map (CSS Grid Simplified Japan) */
        .japan-map {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-template-rows: repeat(12, 1fr);
            gap: 4px;
            max-width: 600px;
            margin: 0 auto;
            aspect-ratio: 1 / 1;
        }
        .pref-cell {
            background-color: #ddd;
            border: 1px solid #999;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
            user-select: none;
            transition: background 0.2s;
            position: relative;
        }
        .pref-cell:hover { background-color: #ccc; }
        .pref-cell.active { background-color: #ff5722 !important; color: white; font-weight: bold; transform: scale(1.1); z-index: 10; }
        .pref-cell.correct { background-color: #4CAF50 !important; color: white; }
        
        /* Voice Button */
        #mic-btn {
            font-size: 24px; padding: 15px 30px; border-radius: 50px; border: none;
            background-color: #ff5722; color: white; cursor: pointer; margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        #mic-btn.listening { background-color: #dc3545; animation: pulse 1.5s infinite; }
        #mic-btn:disabled { background-color: #ccc; cursor: not-allowed; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        .result-msg { font-size: 20px; font-weight: bold; margin-top: 15px; min-height: 30px; }
        .result-msg.correct { color: #2e7d32; }
        .result-msg.wrong { color: #d32f2f; }

        .back-btn { margin-top: 30px; background: #777; padding: 10px 20px; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div id="menu-area">
        <h1>ğŸ‡¯ğŸ‡µ æ—¥æœ¬åœ°å›³ï¼†çœŒåºæ‰€åœ¨åœ°ã‚²ãƒ¼ãƒ </h1>
        <p>éŠã³ãŸã„ãƒ¢ãƒ¼ãƒ‰ã‚’é¸ã‚“ã§ã­</p>
        <button class="menu-btn" onclick="startGame(1)">1. åœ°å›³ã‹ã‚‰ã€ŒçœŒåãƒ»çœŒåºæ‰€åœ¨åœ°ã€ã‚’è¨€ã†</button>
        <button class="menu-btn" onclick="startGame(2)">2. çœŒåã‚’è¦‹ã¦ã€Œåœ°å›³ã€ã‚’å½“ã¦ã‚‹</button>
        <button class="menu-btn" onclick="startGame(3)">3. çœŒåã‹ã‚‰ã€ŒçœŒåºæ‰€åœ¨åœ°ã€ã‚’è¨€ã†ï¼ˆé•ã†19å€‹ï¼‰</button>
        <button class="menu-btn" onclick="startGame(4)">4. çœŒåºæ‰€åœ¨åœ°ã‹ã‚‰ã€ŒçœŒåã€ã‚’è¨€ã†ï¼ˆé•ã†19å€‹ï¼‰</button>
    </div>

    <div id="game-area">
        <h2 id="mode-title">ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰</h2>
        <div class="question-box" id="question-text">ã“ã“ã«å•é¡ŒãŒå‡ºã¾ã™</div>
        <div class="sub-text" id="instruction-text">èª¬æ˜</div>

        <div id="map-container" class="japan-map">
            </div>

        <div id="voice-controls">
            <button id="mic-btn" onclick="toggleRecognition()">ğŸ¤ ç­”ãˆã‚‹</button>
            <div id="voice-status">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦è©±ã—ã¦ã­</div>
        </div>

        <div class="result-msg" id="result-message"></div>

        <button class="back-btn" onclick="showMenu()">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
    </div>
</div>

<script>
    // --- Data: 47 Prefectures ---
    // diff: true means name != capital (Target 19)
    const prefs = [
        { id: 1, name: "åŒ—æµ·é“", capital: "æœ­å¹Œ", yomi: "ã»ã£ã‹ã„ã©ã†", cYomi: "ã•ã£ã½ã‚", r: 1, c: 11, w: 2, h: 2, diff: true },
        { id: 2, name: "é’æ£®", capital: "é’æ£®", yomi: "ã‚ãŠã‚‚ã‚Š", cYomi: "ã‚ãŠã‚‚ã‚Š", r: 3, c: 11, w: 1, h: 1, diff: false },
        { id: 3, name: "å²©æ‰‹", capital: "ç››å²¡", yomi: "ã„ã‚ã¦", cYomi: "ã‚‚ã‚ŠãŠã‹", r: 4, c: 11, w: 1, h: 1, diff: true },
        { id: 4, name: "å®®åŸ", capital: "ä»™å°", yomi: "ã¿ã‚„ã", cYomi: "ã›ã‚“ã ã„", r: 5, c: 11, w: 1, h: 1, diff: true },
        { id: 5, name: "ç§‹ç”°", capital: "ç§‹ç”°", yomi: "ã‚ããŸ", cYomi: "ã‚ããŸ", r: 4, c: 10, w: 1, h: 1, diff: false },
        { id: 6, name: "å±±å½¢", capital: "å±±å½¢", yomi: "ã‚„ã¾ãŒãŸ", cYomi: "ã‚„ã¾ãŒãŸ", r: 5, c: 10, w: 1, h: 1, diff: false },
        { id: 7, name: "ç¦å³¶", capital: "ç¦å³¶", yomi: "ãµãã—ã¾", cYomi: "ãµãã—ã¾", r: 6, c: 11, w: 1, h: 1, diff: false },
        { id: 8, name: "èŒ¨åŸ", capital: "æ°´æˆ¸", yomi: "ã„ã°ã‚‰ã", cYomi: "ã¿ã¨", r: 7, c: 11, w: 1, h: 1, diff: true },
        { id: 9, name: "æ ƒæœ¨", capital: "å®‡éƒ½å®®", yomi: "ã¨ã¡ã", cYomi: "ã†ã¤ã®ã¿ã‚„", r: 6, c: 10, w: 1, h: 1, diff: true },
        { id: 10, name: "ç¾¤é¦¬", capital: "å‰æ©‹", yomi: "ãã‚“ã¾", cYomi: "ã¾ãˆã°ã—", r: 6, c: 9, w: 1, h: 1, diff: true },
        { id: 11, name: "åŸ¼ç‰", capital: "ã•ã„ãŸã¾", yomi: "ã•ã„ãŸã¾", cYomi: "ã•ã„ãŸã¾", r: 7, c: 9, w: 1, h: 1, diff: true }, // Name same, but Kanji diff or City diff
        { id: 12, name: "åƒè‘‰", capital: "åƒè‘‰", yomi: "ã¡ã°", cYomi: "ã¡ã°", r: 8, c: 11, w: 1, h: 1, diff: false },
        { id: 13, name: "æ±äº¬", capital: "æ–°å®¿", yomi: "ã¨ã†ãã‚‡ã†", cYomi: "ã—ã‚“ã˜ã‚…ã", r: 8, c: 9, w: 1, h: 1, diff: true }, // Special
        { id: 14, name: "ç¥å¥ˆå·", capital: "æ¨ªæµœ", yomi: "ã‹ãªãŒã‚", cYomi: "ã‚ˆã“ã¯ã¾", r: 8, c: 8, w: 1, h: 1, diff: true },
        { id: 15, name: "æ–°æ½Ÿ", capital: "æ–°æ½Ÿ", yomi: "ã«ã„ãŒãŸ", cYomi: "ã«ã„ãŒãŸ", r: 5, c: 9, w: 1, h: 1, diff: false },
        { id: 16, name: "å¯Œå±±", capital: "å¯Œå±±", yomi: "ã¨ã‚„ã¾", cYomi: "ã¨ã‚„ã¾", r: 5, c: 8, w: 1, h: 1, diff: false },
        { id: 17, name: "çŸ³å·", capital: "é‡‘æ²¢", yomi: "ã„ã—ã‹ã‚", cYomi: "ã‹ãªã–ã‚", r: 4, c: 7, w: 1, h: 1, diff: true },
        { id: 18, name: "ç¦äº•", capital: "ç¦äº•", yomi: "ãµãã„", cYomi: "ãµãã„", r: 5, c: 7, w: 1, h: 1, diff: false },
        { id: 19, name: "å±±æ¢¨", capital: "ç”²åºœ", yomi: "ã‚„ã¾ãªã—", cYomi: "ã“ã†ãµ", r: 7, c: 8, w: 1, h: 1, diff: true },
        { id: 20, name: "é•·é‡", capital: "é•·é‡", yomi: "ãªãŒã®", cYomi: "ãªãŒã®", r: 6, c: 8, w: 1, h: 1, diff: false },
        { id: 21, name: "å²é˜œ", capital: "å²é˜œ", yomi: "ããµ", cYomi: "ããµ", r: 6, c: 7, w: 1, h: 1, diff: false },
        { id: 22, name: "é™å²¡", capital: "é™å²¡", yomi: "ã—ãšãŠã‹", cYomi: "ã—ãšãŠã‹", r: 8, c: 7, w: 1, h: 1, diff: false },
        { id: 23, name: "æ„›çŸ¥", capital: "åå¤å±‹", yomi: "ã‚ã„ã¡", cYomi: "ãªã”ã‚„", r: 7, c: 7, w: 1, h: 1, diff: true },
        { id: 24, name: "ä¸‰é‡", capital: "æ´¥", yomi: "ã¿ãˆ", cYomi: "ã¤", r: 8, c: 6, w: 1, h: 1, diff: true },
        { id: 25, name: "æ»‹è³€", capital: "å¤§æ´¥", yomi: "ã—ãŒ", cYomi: "ãŠãŠã¤", r: 6, c: 6, w: 1, h: 1, diff: true },
        { id: 26, name: "äº¬éƒ½", capital: "äº¬éƒ½", yomi: "ãã‚‡ã†ã¨", cYomi: "ãã‚‡ã†ã¨", r: 6, c: 5, w: 1, h: 1, diff: false },
        { id: 27, name: "å¤§é˜ª", capital: "å¤§é˜ª", yomi: "ãŠãŠã•ã‹", cYomi: "ãŠãŠã•ã‹", r: 7, c: 5, w: 1, h: 1, diff: false },
        { id: 28, name: "å…µåº«", capital: "ç¥æˆ¸", yomi: "ã²ã‚‡ã†ã”", cYomi: "ã“ã†ã¹", r: 6, c: 4, w: 1, h: 1, diff: true },
        { id: 29, name: "å¥ˆè‰¯", capital: "å¥ˆè‰¯", yomi: "ãªã‚‰", cYomi: "ãªã‚‰", r: 7, c: 6, w: 1, h: 1, diff: false },
        { id: 30, name: "å’Œæ­Œå±±", capital: "å’Œæ­Œå±±", yomi: "ã‚ã‹ã‚„ã¾", cYomi: "ã‚ã‹ã‚„ã¾", r: 8, c: 5, w: 1, h: 1, diff: false },
        { id: 31, name: "é³¥å–", capital: "é³¥å–", yomi: "ã¨ã£ã¨ã‚Š", cYomi: "ã¨ã£ã¨ã‚Š", r: 6, c: 3, w: 1, h: 1, diff: false },
        { id: 32, name: "å³¶æ ¹", capital: "æ¾æ±Ÿ", yomi: "ã—ã¾ã­", cYomi: "ã¾ã¤ãˆ", r: 6, c: 2, w: 1, h: 1, diff: true },
        { id: 33, name: "å²¡å±±", capital: "å²¡å±±", yomi: "ãŠã‹ã‚„ã¾", cYomi: "ãŠã‹ã‚„ã¾", r: 7, c: 3, w: 1, h: 1, diff: false },
        { id: 34, name: "åºƒå³¶", capital: "åºƒå³¶", yomi: "ã²ã‚ã—ã¾", cYomi: "ã²ã‚ã—ã¾", r: 7, c: 2, w: 1, h: 1, diff: false },
        { id: 35, name: "å±±å£", capital: "å±±å£", yomi: "ã‚„ã¾ãã¡", cYomi: "ã‚„ã¾ãã¡", r: 7, c: 1, w: 1, h: 1, diff: false },
        { id: 36, name: "å¾³å³¶", capital: "å¾³å³¶", yomi: "ã¨ãã—ã¾", cYomi: "ã¨ãã—ã¾", r: 9, c: 4, w: 1, h: 1, diff: false },
        { id: 37, name: "é¦™å·", capital: "é«˜æ¾", yomi: "ã‹ãŒã‚", cYomi: "ãŸã‹ã¾ã¤", r: 8, c: 4, w: 1, h: 1, diff: true },
        { id: 38, name: "æ„›åª›", capital: "æ¾å±±", yomi: "ãˆã²ã‚", cYomi: "ã¾ã¤ã‚„ã¾", r: 9, c: 2, w: 1, h: 1, diff: true },
        { id: 39, name: "é«˜çŸ¥", capital: "é«˜çŸ¥", yomi: "ã“ã†ã¡", cYomi: "ã“ã†ã¡", r: 9, c: 3, w: 1, h: 1, diff: false },
        { id: 40, name: "ç¦å²¡", capital: "ç¦å²¡", yomi: "ãµããŠã‹", cYomi: "ãµããŠã‹", r: 8, c: 1, w: 1, h: 1, diff: false },
        { id: 41, name: "ä½è³€", capital: "ä½è³€", yomi: "ã•ãŒ", cYomi: "ã•ãŒ", r: 8, c: 0, w: 1, h: 1, diff: false }, // Shifted left
        { id: 42, name: "é•·å´", capital: "é•·å´", yomi: "ãªãŒã•ã", cYomi: "ãªãŒã•ã", r: 9, c: 0, w: 1, h: 1, diff: false },
        { id: 43, name: "ç†Šæœ¬", capital: "ç†Šæœ¬", yomi: "ãã¾ã‚‚ã¨", cYomi: "ãã¾ã‚‚ã¨", r: 9, c: 1, w: 1, h: 1, diff: false },
        { id: 44, name: "å¤§åˆ†", capital: "å¤§åˆ†", yomi: "ãŠãŠã„ãŸ", cYomi: "ãŠãŠã„ãŸ", r: 8, c: 2, w: 1, h: 1, diff: false },
        { id: 45, name: "å®®å´", capital: "å®®å´", yomi: "ã¿ã‚„ã–ã", cYomi: "ã¿ã‚„ã–ã", r: 10, c: 2, w: 1, h: 1, diff: false },
        { id: 46, name: "é¹¿å…å³¶", capital: "é¹¿å…å³¶", yomi: "ã‹ã”ã—ã¾", cYomi: "ã‹ã”ã—ã¾", r: 11, c: 1, w: 1, h: 1, diff: false },
        { id: 47, name: "æ²–ç¸„", capital: "é‚£è¦‡", yomi: "ãŠããªã‚", cYomi: "ãªã¯", r: 12, c: 0, w: 1, h: 1, diff: true }
    ];

    let currentMode = 0;
    let currentPref = null;
    let recognition;
    let isListening = false;

    // --- Init Map ---
    const mapContainer = document.getElementById('map-container');
    
    // Create grid items
    prefs.forEach(p => {
        const div = document.createElement('div');
        div.className = 'pref-cell';
        div.innerText = p.name;
        div.dataset.id = p.id;
        div.style.gridRowStart = p.r;
        div.style.gridColumnStart = p.c + 1; // 1-based index
        div.style.gridRowEnd = `span ${p.h}`;
        div.style.gridColumnEnd = `span ${p.w}`;
        
        div.onclick = () => handleMapClick(p);
        mapContainer.appendChild(div);
    });

    // --- Voice Setup ---
    if ('webkitSpeechRecognition' in window) {
        recognition = new webkitSpeechRecognition();
        recognition.lang = 'ja-JP';
        recognition.continuous = false;
        recognition.interimResults = false;

        recognition.onstart = () => {
            isListening = true;
            document.getElementById('mic-btn').classList.add('listening');
            document.getElementById('voice-status').innerText = "èã„ã¦ã„ã¾ã™...";
        };
        recognition.onend = () => {
            isListening = false;
            document.getElementById('mic-btn').classList.remove('listening');
            document.getElementById('voice-status').innerText = "ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦è©±ã—ã¦ã­";
        };
        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            checkVoiceAnswer(transcript);
        };
    } else {
        alert("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚Chromeã¾ãŸã¯Edgeã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚");
    }

    // --- Game Logic ---
    function showMenu() {
        document.getElementById('menu-area').style.display = 'block';
        document.getElementById('game-area').style.display = 'none';
        resetMap();
    }

    function startGame(mode) {
        currentMode = mode;
        document.getElementById('menu-area').style.display = 'none';
        document.getElementById('game-area').style.display = 'block';
        document.getElementById('result-message').innerText = "";
        
        // Mode Specific Setup
        const titles = ["", "1. åœ°å›³ã‹ã‚‰çœŒåãƒ»çœŒåºæ‰€åœ¨åœ°", "2. åœ°å›³ã®å ´æ‰€å½“ã¦", "3. çœŒåâ†’çœŒåºæ‰€åœ¨åœ° (19)", "4. çœŒåºæ‰€åœ¨åœ°â†’çœŒå (19)"];
        document.getElementById('mode-title').innerText = titles[mode];
        
        // UI Adjustments
        const map = document.getElementById('map-container');
        const voice = document.getElementById('voice-controls');

        if (mode === 2) {
            map.style.pointerEvents = "auto"; // Clickable map
            voice.style.display = "none"; // No voice for clicking game
        } else {
            map.style.pointerEvents = "none"; // View only
            voice.style.display = "block";
        }

        nextQuestion();
    }

    function nextQuestion() {
        resetMap();
        document.getElementById('result-message').innerText = "";

        // Filter Questions based on Mode
        let pool = prefs;
        if (currentMode === 3 || currentMode === 4) {
            pool = prefs.filter(p => p.diff); // Only diff 19
        }
        
        // Pick Random
        currentPref = pool[Math.floor(Math.random() * pool.length)];

        // Display logic
        const qText = document.getElementById('question-text');
        const iText = document.getElementById('instruction-text');

        if (currentMode === 1) {
            qText.innerText = "ã“ã®å ´æ‰€ã¯ã©ã“ï¼Ÿ";
            iText.innerText = "çœŒåã¨çœŒåºæ‰€åœ¨åœ°ã‚’è¨€ã£ã¦ã­ï¼ˆä¾‹ï¼šã€Œã»ã£ã‹ã„ã©ã†ã€ã•ã£ã½ã‚ã€ï¼‰";
            highlightMap(currentPref.id);
        } else if (currentMode === 2) {
            qText.innerText = `${currentPref.name}çœŒ ã¯ã©ã“ï¼Ÿ`;
            iText.innerText = "åœ°å›³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã­";
        } else if (currentMode === 3) {
            qText.innerText = `${currentPref.name}çœŒ`;
            iText.innerText = "ã“ã®çœŒã®ã€ŒçœŒåºæ‰€åœ¨åœ°ã€ã¯ï¼Ÿ";
        } else if (currentMode === 4) {
            qText.innerText = `${currentPref.capital}å¸‚`; // Tokyo might need adjustment but 'City' is usually fine for prompts
            if(currentPref.name === "æ±äº¬") qText.innerText = "æ–°å®¿åŒºï¼ˆæ±äº¬éƒ½åºï¼‰";
            iText.innerText = "ã“ã‚Œã¯ä½•çœŒã®çœŒåºæ‰€åœ¨åœ°ï¼Ÿ";
        }
    }

    // --- Answer Checking ---

    // 1. Voice Answer
    function toggleRecognition() {
        if (isListening) recognition.stop();
        else recognition.start();
    }

    function checkVoiceAnswer(text) {
        text = text.replace(/çœŒ|å¸‚|åºœ|éƒ½/g, ""); // Remove suffix for easier matching
        const correctName = currentPref.name.replace(/çœŒ|å¸‚|åºœ|éƒ½/g, "");
        const correctCap = currentPref.capital.replace(/çœŒ|å¸‚|åºœ|éƒ½/g, "");
        const correctYomi = currentPref.yomi;
        const correctCYomi = currentPref.cYomi;

        let isCorrect = false;
        let msg = "";

        if (currentMode === 1) {
            // Needs Name AND Capital? Or allow either? User said "Say Name, Capital".
            // Let's be generous: If they say both, great. If they say one, maybe OK? 
            // Strict: Must contain both concepts or user will be confused.
            // Let's check if the string contains key phonemes.
            const gotName = text.includes(correctName) || text.includes(correctYomi);
            const gotCap = text.includes(correctCap) || text.includes(correctCYomi);
            
            if (gotName && gotCap) {
                isCorrect = true;
                msg = `æ­£è§£ï¼ ${currentPref.name}ï¼ˆ${currentPref.capital}ï¼‰`;
            } else if (gotName) {
                msg = `æƒœã—ã„ï¼çœŒåã¯åˆã£ã¦ã‚‹ã€‚çœŒåºæ‰€åœ¨åœ°ã¯ï¼Ÿ`;
            } else {
                msg = `ä¸æ­£è§£... æ­£è§£ã¯ ${currentPref.name}ãƒ»${currentPref.capital}`;
            }
        } else if (currentMode === 3) {
            // Target: Capital
            if (text.includes(correctCap) || text.includes(correctCYomi)) {
                isCorrect = true;
                msg = `æ­£è§£ï¼ ${currentPref.capital}`;
            } else {
                msg = `é•ã†ã‚ˆã€‚æ­£è§£ã¯ ${currentPref.capital}`;
            }
        } else if (currentMode === 4) {
            // Target: Prefecture
            if (text.includes(correctName) || text.includes(correctYomi)) {
                isCorrect = true;
                msg = `æ­£è§£ï¼ ${currentPref.name}`;
            } else {
                msg = `é•ã†ã‚ˆã€‚æ­£è§£ã¯ ${currentPref.name}`;
            }
        }

        showResult(isCorrect, msg);
    }

    // 2. Map Click Answer (Mode 2)
    function handleMapClick(clickedPref) {
        if (currentMode !== 2) return;
        
        let isCorrect = false;
        let msg = "";

        if (clickedPref.id === currentPref.id) {
            isCorrect = true;
            msg = `æ­£è§£ï¼ã“ã“ãŒ ${currentPref.name} ã§ã™ã€‚`;
        } else {
            msg = `æ®‹å¿µ... ãã“ã¯ ${clickedPref.name} ã§ã™ã€‚`;
        }
        showResult(isCorrect, msg);
    }

    function showResult(isCorrect, msg) {
        const resDiv = document.getElementById('result-message');
        resDiv.innerText = msg;
        resDiv.className = "result-msg " + (isCorrect ? "correct" : "wrong");

        if (isCorrect) {
            // Play chime or wait
            setTimeout(nextQuestion, 2000);
        }
    }

    // --- Helpers ---
    function resetMap() {
        document.querySelectorAll('.pref-cell').forEach(el => {
            el.classList.remove('active');
            el.style.backgroundColor = "";
        });
    }

    function highlightMap(id) {
        const el = document.querySelector(`.pref-cell[data-id='${id}']`);
        if (el) el.classList.add('active');
    }

</script>
</body>
</html>